var Merlin=function(i,_){var n={install_child:function(e){(new t).init(e)},install_plugins:function(e){(new o).init(e)},install_content:function(e){(new s).init(e)}};function e(){var t=_(".merlin__body"),e=_("#merlin__drawer-trigger");drawer_opened="merlin__drawer--open",setTimeout(function(){t.addClass("loaded")},100),e.on("click",function(){t.toggleClass(drawer_opened)}),_(".merlin__button--proceed:not(.merlin__button--closer)").click(function(e){e.preventDefault();var n=this.getAttribute("href");t.addClass("exiting"),setTimeout(function(){window.location=n},400)}),_(".merlin__button--closer").on("click",function(e){t.removeClass(drawer_opened),e.preventDefault();var n=this.getAttribute("href");setTimeout(function(){t.addClass("exiting")},600),setTimeout(function(){window.location=n},1100)}),_(".button-next").on("click",function(e){if(e.preventDefault(),!function(e){var n=jQuery(e);if("yes"==n.data("done-loading"))return!1;n.is("input")||n.is("button");return n.data("done-loading","yes"),n.addClass("merlin__button--loading"),{done:function(){n.attr("disabled",!1)}}}(this))return!1;e=_(this).data("callback");return!e||void 0===n[e]||(n[e](this),!1)}),_(document).on("change",".js-merlin-demo-import-select",function(){var e=_(".js-merlin-demo-import-select").val();_(".js-merlin-select-spinner").show(),_.post(merlin_params.ajaxurl,{action:"merlin_update_selected_import_data_info",wpnonce:merlin_params.wpnonce,selected_index:e},function(e){e.success?_(".js-merlin-drawer-import-content").html(e.data):alert(merlin_params.texts.something_went_wrong),_(".js-merlin-select-spinner").hide()}).fail(function(){_(".js-merlin-select-spinner").hide(),alert(merlin_params.texts.something_went_wrong)})})}function t(){var n,t=_(".merlin__body"),i=_("#child-theme-text");function o(e){void 0!==e.done?(setTimeout(function(){i.addClass("lead")},0),setTimeout(function(){i.addClass("success"),i.html(e.message)},600),n()):(i.addClass("lead error"),i.html(e.error))}return{init:function(e){n=function(){setTimeout(function(){_(".merlin__body").addClass("js--finished")},1500),t.removeClass(drawer_opened),setTimeout(function(){_(".merlin__body").addClass("exiting")},3500),setTimeout(function(){window.location.href=e.href},4e3)},jQuery.post(merlin_params.ajaxurl,{action:"merlin_child_theme",wpnonce:merlin_params.wpnonce},o).fail(o)}}}function o(){return{init:function(e){if(i){pagenow=merlin_params.pagenow;var n=_(e),t=_("p#plugin-text");if(n.hasClass("activate-now"))return _(".merlin__button.merlin__button--next").html(merlin_params.texts.activating),jQuery.post(merlin_params.ajaxurl,{action:"merlin_activate_plugin",wpnonce:merlin_params.wpnonce,plugin:n.data("slug")},function(e){void 0!==e.done?(setTimeout(function(){t.addClass("lead")},0),setTimeout(function(){t.addClass("success"),t.html(e.message)},600),setTimeout(function(){_(".merlin__body").addClass("js--finished"),_(".merlin__button").removeClass("merlin__button--loading"),_(".merlin__button.merlin__button--next").html(merlin_params.texts.next)},1300),_(".merlin__body").removeClass(drawer_opened),setTimeout(function(){_(".merlin__body").addClass("exiting")},3500),setTimeout(function(){window.location.href=merlin_params.next_link},4e3)):(setTimeout(function(){t.addClass("lead")},0),setTimeout(function(){t.addClass("error"),t.html(e.error)},600),setTimeout(function(){_(".merlin__button").removeClass("merlin__button--loading"),_(".merlin__button.merlin__button--next").data("done-loading","no").html(merlin_params.texts.try_again),t.removeClass("lead success error")},1500))}),!0;n.hasClass("updating-message")||n.hasClass("button-disabled")||(i.updates.shouldRequestFilesystemCredentials&&!i.updates.ajaxLocked&&(i.updates.requestFilesystemCredentials(e),_(document).on("credential-modal-cancel",function(){_(".merlin-install-now.updating-message").removeClass("updating-message").text(i.updates.l10n.installNow),i.a11y.speak(i.updates.l10n.updateCancel,"polite")})),i.updates.installPlugin({slug:n.data("slug"),pagenow:pagenow,success:function(){_(".merlin__button.merlin__button--next").html(merlin_params.texts.activating),jQuery.post(merlin_params.ajaxurl,{action:"merlin_activate_plugin",wpnonce:merlin_params.wpnonce,plugin:n.data("slug")},function(){setTimeout(function(){t.addClass("lead")},0),setTimeout(function(){t.addClass("success"),t.html(merlin_params.texts.plugin_success)},600),setTimeout(function(){_(".merlin__body").addClass("js--finished"),_(".merlin__button.merlin__button--next").removeClass("merlin__button--loading"),_(".merlin__button.merlin__button--next").html(merlin_params.texts.next)},1300),_(".merlin__body").removeClass(drawer_opened),setTimeout(function(){_(".merlin__body").addClass("exiting")},3500),setTimeout(function(){window.location.href=merlin_params.next_link},4e3)})},error:function(){setTimeout(function(){t.addClass("lead")},0),setTimeout(function(){t.addClass("error"),t.html(merlin_params.texts.plugin_install_error),_(".merlin__button.merlin__button--next").data("done-loading","no").html(merlin_params.texts.try_again)},600),setTimeout(function(){_(".merlin__button").removeClass("merlin__button--loading updating-message button-disabled"),t.removeClass("lead success error")},1300)}}))}}}}function s(){var t,i,o,n=_(".merlin__body"),s=0,a="",r="",l=1,m=0;function d(e){console.log(e);var n=i.find("label");"object"==typeof e&&void 0!==e.message?(n.addClass(e.message.toLowerCase()),void 0!==e.num_of_imported_posts&&0<m&&(l="all"===e.num_of_imported_posts?m:e.num_of_imported_posts,c()),void 0!==e.url?e.hash===r?(n.addClass("status--failed"),u()):(r=e.hash,void 0===e.selected_index&&(e.selected_index=_(".js-merlin-demo-import-select").val()||0),jQuery.post(e.url,e,d).fail(d)):(e.done,u())):(console.log(e),n.addClass("status--error"),u())}function u(){var e=!1;i&&(i.data("done_item")||(s++,i.data("done_item",1)),i.find(".spinner").css("visibility","hidden"));var n=_(".merlin__drawer--import-content__list-item");_(".merlin__drawer--import-content__list-item input:checked");n.each(function(){""==a||e?(a=_(this).data("content"),i=_(this),a&&(i.find("input:checkbox").is(":checked")?jQuery.post(merlin_params.ajaxurl,{action:"merlin_content",wpnonce:merlin_params.wpnonce,content:a,selected_index:_(".js-merlin-demo-import-select").val()||0},d).fail(d):(i.addClass("skipping"),setTimeout(u,300))),e=!1):_(this).data("content")==a&&(e=!0)}),s>=n.length&&t()}function c(){_(".js-merlin-progress-bar").css("width",l/m*100+"%");var e,n,t,e=(e=l/m*100,n=0,t=99,Math.min(t,Math.max(n,e)));_(".js-merlin-progress-bar-percentage").html(Math.round(e)+"%"),1==l/m&&clearInterval(o)}return{init:function(e){_(".merlin__drawer--import-content").addClass("installing"),_(".merlin__drawer--import-content").find("input").prop("disabled",!0),t=function(){_.post(merlin_params.ajaxurl,{action:"merlin_import_finished",wpnonce:merlin_params.wpnonce,selected_index:_(".js-merlin-demo-import-select").val()||0}),setTimeout(function(){_(".js-merlin-progress-bar-percentage").html("100%")},100),setTimeout(function(){n.removeClass(drawer_opened)},500),setTimeout(function(){_(".merlin__body").addClass("js--finished")},1500),setTimeout(function(){_(".merlin__body").addClass("exiting")},3400),setTimeout(function(){window.location.href=e.href},4e3)},_(".merlin__drawer--import-content__list-item .checkbox-content").is(":checked")&&jQuery.post(merlin_params.ajaxurl,{action:"merlin_get_total_content_import_items",wpnonce:merlin_params.wpnonce,selected_index:_(".js-merlin-demo-import-select").val()||0},function(e){0<(m=e.data)&&(c(),o=setInterval(function(){l+=m/500,c()},1e3))}),u()}}}return{init:function(){_(e)},callback:function(e){console.log(e),console.log(this)}}}(window.wp,jQuery);Merlin.init();