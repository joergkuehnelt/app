!function(n){"use strict";if("undefined"!=typeof wcb2b_livesearch_params){var t=function(){this.requests=[],this.addRequest=this.addRequest.bind(this),this.run=this.run.bind(this),n(document.body).on("keyup",".wcb2b-livesearch input",{WCB2BLiveSearchHandler:this},this.onSearch).on("click",".wcb2b-livesearch .button",{WCB2BLiveSearchHandler:this},this.onAddToCart).on("added_to_cart",this.updateButton).on("ajax_request_not_sent.adding_to_cart",this.updateButton).on("added_to_cart",{WCB2BLiveSearchHandler:this},this.updateFragments)};t.prototype.addRequest=function(t){this.requests.push(t),1===this.requests.length&&this.run()},t.prototype.run=function(){var t=this,e=t.requests[0].complete;t.requests[0].complete=function(){"function"==typeof e&&e(),t.requests.shift(),0<t.requests.length&&t.run()},n.ajax(this.requests[0])},t.prototype.onSearch=function(t){var e=n(".wcb2b-livesearch"),a=e.find('input[type="search"]').val();a.length>=wcb2b_livesearch_params.min_lenght?t.data.WCB2BLiveSearchHandler.addRequest({type:"POST",url:wcb2b_livesearch_params.ajax_url,data:{action:"wcb2b_livesearch_results",keyword:a,page:wcb2b_livesearch_params.current_url},beforeSend:function(){e.addClass("loading")},success:function(t){t&&e.find(".wcb2b-livesearch-products").html(t)},complete:function(){e.removeClass("loading")}}):e.find(".wcb2b-livesearch-products").html("")},t.prototype.onAddToCart=function(t){var e=n(this);if(!e.attr("data-product_id"))return!0;if(t.preventDefault(),e.removeClass("added"),e.addClass("loading"),!1===n(document.body).triggerHandler("should_send_ajax_request.adding_to_cart",[e]))return n(document.body).trigger("ajax_request_not_sent.adding_to_cart",[!1,!1,e]),!0;var a={};n.each(e.data(),function(t,e){a[t]=e}),n.each(e[0].dataset,function(t,e){a[t]=e}),n(document.body).trigger("adding_to_cart",[e,a]),t.data.WCB2BLiveSearchHandler.addRequest({type:"POST",url:wcb2b_livesearch_params.wc_ajax_url.toString().replace("%%endpoint%%","add_to_cart"),data:a,success:function(t){t&&n(document.body).trigger("added_to_cart",[t.fragments,t.cart_hash,e])},dataType:"json"})},t.prototype.updateButton=function(t,e,a,r){(r=void 0!==r&&r)&&(r.removeClass("loading"),e&&r.addClass("added"),e&&0===r.parent().find(".added_to_cart").length&&r.text(wcb2b_livesearch_params.i18n_added_to_cart),n(document.body).trigger("wc_cart_button_updated",[r]))},t.prototype.updateFragments=function(t,e){e&&(n.each(e,function(t){n(t).addClass("updating").fadeTo("400","0.6").block({message:null,overlayCSS:{opacity:.6}})}),n.each(e,function(t,e){n(t).replaceWith(e),n(t).stop(!0).css("opacity","1").unblock()}),n(document.body).trigger("wc_fragments_loaded"))},new t}}(jQuery);